var checkcode="";var tools=new tool();var params={};var isShowCountDown=0;function checkmobile(){var a="";var c=$.cookie("userID"),b=$("#bind_phone").val();a=tools.checkMobile(b);if(a.isCorrect==false){$("#validTips").html(a.message).css("display","block");return false}if(tools.IsEmpty(c)){c=0}params.type="POST";params.async=false;params.url="../ajax/CheckCodeToPhone/CheckMobileIsBind.ashx";params.data={phone:b,userID:c};params.dataType="text";params.success=function(d){a=d};tools.ajax(params);switch(a){case"1":$("#validTips").html("").css("display","none");return true;case"-1":$("#validTips").html("该手机号已被绑定。").css("display","block");return false;case"-2":$("#validTips").html("该手机号已被绑定。").css("display","block");return false;case"-3":$("#validTips").html("请输入11位手机号。").css("display","block");return false;default:$("#validTips").html("该手机号已被绑定。").css("display","block");return false}}function showCountdown(){var b=60;$("#request_valid").attr("disabled","disabled");$("#validTips").css("color","#888888");$("#validTips").html("校验码已发出，请注意查收短信，若没收到，您可在<span style='color:Red'>"+b+"</span>秒后要求系统重新发送。").css({display:"block",background:"f9f9f9","border-color":"#d4d4d4"});var a=setInterval(function(){if(b==0){clearInterval(a);$("#request_valid").removeAttr("disabled");$("#validTips").html("").css("display","none")}else{b--;$("#validTips").html("校验码已发出，请注意查收短信，若没收到，您可在<span style='color:Red'>"+b+"</span>秒后要求系统重新发送。").css("display","block")}},1400);isShowCountDown=1}function sendCheckCode(c){var b=$("#bind_phone").val();var a="";if(c!=""&&!checkall("invite")){return false}if(!checkmobile()){return false}params.type="POST";params.async=false;params.url="../ajax/CheckCodeToPhone/GetCheckCodeToPhone.ashx";params.data={phone:b};params.success=function(d){a=d};tools.ajax(params);switch(a){case"0":$("#validTips").html("距离上一次发送验证码不超过1分钟。").css("display","block");return false;case"-1":$("#validTips").html("很抱歉，暂时无法发送验证码，再重新试下好吗？").css("display","block");return false;case"-2":$("#validTips").html("很抱歉，您现在不是注册用户，无法使用此功能。").css("display","block");return false;case"-12":$("#validTips").html("很抱歉，您暂时无法使用此功能，请刷新页面重新使用。").css("display","block");return false;default:checkcode=a;showCountdown();return true}}function checkCode(){var c=$("#input_valid").val(),b=$("#bind_phone").val(),a=0;if(checkcode==""){$("#validTips").html("您还没有获取校验码。").css("display","block");return false}else{$.ajax({type:"POST",async:false,url:"../ajax/CheckCodeToPhone/CheckValidCodeAndMobile.ashx",data:{phone:b,code:c},dataType:"text",success:function(d){switch(d){case"1":a=1;break;case"-1":$("#validTips").html("手机号和验证码不匹配").css("display","block");break;default:$("#validTips").html("暂时无法绑定，请稍候再试").css("display","block");break}}});return a==0?false:true}}function bindmobile(g){var e=$("#input_valid").val(),d=0,c=$("#bind_phone").val(),i="",a=new RegExp("^[1][0-9]{10}");i=tools.checkMobile(c);if(i.isCorrect==false){$("#validTips").html(i.message).css("display","block");return false}if(!checkCode()){return false}if(!checkmobile()){return false}var h=$.cookie("userID"),f=$("#bind_phone").val(),b=$.cookie("kcb");if(b==null){return false}$.ajax({type:"POST",async:false,url:"../ajax/ChangeBindPhone.ashx",data:{userID:h,phone:f,password:b},success:function(j){if(j=="1"){if(g.indexOf("float")>=0){$(".minLoginBg,.minLogReg").css("display","none");$.XYTipsWindow({___title:"开吃吧提示",___drag:"___boxTitle",___width:"300px",___height:"100px",___content:'text:<p style="color:#555;text-align: center;margin-top:40px;font-size:16px;font-weight:bold;">绑定成功!</p>',___showbg:true,___time:1800});if(g.indexOf("float_show")>=0){$("#bindPhone").html(f)}$("#bind_phone").val("")}if(g=="alert"){$.XYTipsWindow({___title:"开吃吧提示",___drag:"___boxTitle",___width:"300px",___height:"100px",___content:'text:<p style="color:#555;text-align: center;margin-top:40px;font-size:16px;font-weight:bold;">绑定成功!</p>',___showbg:true,___time:1800});$("#bind_phone").val("")}if(g=="notalert"){}$("#input_valid").val("");$("#validTips").html("").css("display","none");d=1}else{if(j=="-1"){$("#validTips").html("哦～您忘了该手机号已经绑定了。").css("display","block")}else{if(j=="-2"){$("#validTips").html("手机号好像错了～").css("display","block")}else{if(j=="-3"){$("#validTips").html("该手机号已被绑定，请更换手机号。").css("display","block")}else{$("#validTips").html("系统暂时无法处理，请稍后再试！").css("display","block")}}}}}});if(d==0){return false}d=0;checkcode="";$.ajax({type:"POST",async:false,url:"../ajax/CheckCodeToPhone/DeleteCheckCodeToPhone.ashx",data:{Phone:f},success:function(j){if(j==1){d=1}else{}}});if(d==0){return false}else{return true}}$(document).ready(function(){$("#request_valid").click(function(){sendCheckCode("")});$("#bind_Btn").click(function(){bindmobile("float")})});